/*! Ajax File Upload Plugin - v1.0.0 - 2013-02-24
* https://github.com/jchild3rs/AjaxFileUpload
* Copyright (c) 2013 James Childers; Licensed MIT */
(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function m(e,r){this.input=e,this.upload=t(this.upload,this),this.reset=t(this.reset,this);if(this.input===null||this.input.type!=="file")return;this.settings=h.merge(n,r);if(this.input.multiple||this.settings.multiple)this.input.multiple=!0,this.settings.multiple=!0;this.settings.allowedTypes.length>0&&h.attr(this.input,{accept:this.settings.allowedTypes.join()}),this.settings.url===""&&(this.settings.url=this.input.getAttribute("data-url")),this.settings.url===""&&this.input.form.action!==""&&(this.settings.url=this.input.form.action);if(this.settings.url==="")return;this.settings.additionalData!=={}&&(this.settings.url+=""+h.serialize(this.settings.additionalData)),this.settings.showCustomInput&&c(this),i(this),window.AjaxFileUpload=window.AjaxFileUpload||m,window.AjaxFileUpload.instances=m.instances||[],window.AjaxFileUpload.instances[this.input.id]=this;return}var e,n,r,i,s,o,u,a,f,l,c,h,p,d,v=this;return n={url:"",additionalData:{},autoUpload:!1,dataType:"json",method:"post",pathToSwf:"/dist/AjaxFileUpload.swf",showCustomInput:!1,buttonEmptyText:"Select",buttonSelectedText:"Upload",showProgressBar:!1,progressBarElement:"",debug:!1,multiple:!1,sizeLimit:0,allowedTypes:[],onSuccess:function(){},onError:function(){},onFileSelect:function(){},onProgress:function(){},onProgressStart:function(){},onProgressEnd:function(){}},m.prototype.reset=function(){var e;e=document.getElementById("fu-button-"+this.input.id),e.innerHTML=this.settings.buttonEmptyText,this.input.value="",h.css(this.input,{display:"block"})},m.prototype.upload=function(){e(this)},f=function(t,n){var i,s,o;o=n.settings,o.showCustomInput&&(i=document.getElementById("fu-button-"+t.target.id),s=document.getElementById("fu-input-"+t.target.id)),d(n)&&(o.autoUpload&&e(n),o.onFileSelect.apply(o,[t.target.files]),o.showCustomInput&&(i.innerHTML=o.buttonSelectedText,h.css(n.input,{display:"none"}),i.onclick=function(){return e(n),!1},r(s,t.target.files)))},e=function(e){var t,n,r,i,f,l;if(e.input.files.length===0)return;r=new XMLHttpRequest,r.upload?(r.upload.addEventListener("progress",function(t){return s(t,e)}),r.upload.addEventListener("loadstart",function(t){return u(t,e)}),r.upload.addEventListener("load",function(t){return o(t,e)})):r.addEventListener("progress",function(t){return s(t,e)}),r.addEventListener("readystatechange",function(t){return a(t,e)}),n=new FormData,l=e.input.files;for(i=0,f=l.length;i<f;i++)t=l[i],n.append(t.name,t);r.open(e.settings.method,e.settings.url,!0);switch(e.settings.dataType){case"json":r.setRequestHeader("Accept","application/json");break;case"xml":r.setRequestHeader("Accept","text/xml");break;default:}r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(n)},a=function(e,t){var n,r,i,s;r=e.target;if(r.readyState!==4)return;n=r.responseText,~r.getResponseHeader("content-type").indexOf("application/json")&&!!window.JSON&&(n=JSON.parse(n)),r.status===200||r.status===201?((i=t.settings).onSuccess.apply(i,[n,t.input.files,r]),t.reset()):(s=t.settings).onError.apply(s,[n,t.input.files,r])},u=function(e,t){var n;return document.getElementById("fu-wrap-"+t.input.id).className+=" fu-loading",(n=t.settings).onProgressStart.apply(n,[t.input.files,e.target])},s=function(e,t){var n;return(n=t.settings).onProgress.apply(n,[e.loaded,e.total,t.input.files,e.target])},o=function(e,t){var n;return document.getElementById("fu-wrap-"+t.input.id).className=document.getElementById("fu-wrap-"+t.input.id).className.replace(" fu-loading",""),(n=t.settings).onProgressEnd.apply(n,[t.input.files,e.target])},i=function(e){var t,n,r,i,s,o,u,a,f,l,c;t=e.settings.allowedTypes,t=t.join(";").replace(/[a-z]*\//ig,"*."),i={id:e.input.id,url:e.settings.url,method:e.settings.method,debug:e.settings.debug,multiple:e.settings.multiple,additionalData:e.settings.additionalData,sizeLimit:e.settings.sizeLimit,allowedTypes:t},a={movie:e.settings.pathToSwf,quality:"low",play:"true",loop:"true",wmode:"transparent",scale:"noscale",menu:"true",devicefont:"false",salign:"",allowScriptAccess:"sameDomain",flashvars:h.serialize(i)},n={src:e.settings.pathToSwf,id:"fu-embed-"+e.input.id,name:"fu-embed-"+e.input.id,classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",FlashVars:h.serialize(i),width:e.input.offsetWidth+5,height:e.input.offsetHeight+5,style:"position: absolute"},r=document.getElementById("fu-embed-"+e.input.id),r||(r=document.createElement("embed")),o=document.getElementById("fu-object-"+e.input.id),o||(o=document.createElement("object")),c=document.getElementById("fu-wrap-"+e.input.id),r.onmouseover=function(){return h.attr(c,{"class":"fu-wrap fu-hover"})},r.onmouseout=function(){return h.attr(c,{"class":"fu-wrap"})},r.onmousedown=function(){return h.attr(c,{"class":"fu-wrap fu-active"})},r.onmouseup=function(){return h.attr(c,{"class":"fu-wrap"})},h.attr(o,{classid:"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",id:"fu-object-"+e.input.id,align:"left"});for(s in a)l=a[s],a.hasOwnProperty(s)&&(u=document.createElement("param"),h.attr(u,{name:s,value:l}),o.appendChild(u));h.attr(r,h.merge(n,a)),o.appendChild(r),e.settings.showCustomInput?(f=document.getElementById("fu-button-"+e.input.id),f.parentNode.insertBefore(o,f.nextSibling),e.input.style.display="none"):e.input.parentNode.insertBefore(o,e.input.nextSibling)},c=function(e){var t,n,r,i,s;return r=e.input,s="fu-wrap-"+r.id,i=document.createElement("div"),h.attr(i,{"class":"fu-wrap",id:s}),h.css(i,{position:"relative"}),n=document.createElement("input"),h.attr(n,{type:"text",disabled:"disabled","class":"fu-input",id:"fu-input-"+r.id}),t=document.createElement("button"),h.attr(t,{"class":"fu-button",id:"fu-button-"+r.id}),e.settings.autoUpload?t.innerHTML=e.settings.buttonSelectedText:t.innerHTML=e.settings.buttonEmptyText,t.onclick=function(e){return!1},i.appendChild(n),i.appendChild(t),r.parentNode.insertBefore(i,r.nextSibling),i.appendChild(r),h.css(r,{position:"absolute",top:0,left:0,opacity:0}),r.onmouseover=function(){return h.attr(i,{"class":"fu-wrap fu-hover"})},r.onmouseout=function(){return h.attr(i,{"class":"fu-wrap"})},r.onmousedown=function(){return h.attr(i,{"class":"fu-wrap fu-active"})},r.onmouseup=function(){return h.attr(i,{"class":"fu-wrap"})},h.css(r,{width:document.getElementById(s).clientWidth+"px",height:document.getElementById(s).clientHeight+"px"}),r},r=function(e,t){var n,r,i,s;if(t.length===0)return;if(t.length===1)return e.value=t[0].name;if(t.length>1){r="";for(i=0,s=t.length;i<s;i++)n=t[i],r+=n.name+" ";return e.value=r}},h={css:function(e,t){var n,r;for(n in t)r=t[n],e.style[n]=r},attr:function(e,t){var n,r;for(n in t)r=t[n],n==="class"?e.className=r:t.hasOwnProperty(n)&&e.setAttribute(n,r)},serialize:function(e,t){var n,r,i,s;i=[];for(r in e)s=e[r],n=t?t+"["+r+"]":r,typeof s=="object"?i.push(h.serialize(s,n)):i.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return i.join("&")},merge:function(e,t){var n;for(n in t)try{t[n].constructor===Object?e[n]=h.merge(e[n],t[n]):e[n]=t[n]}catch(r){e[n]=t[n]}return e}},l={fileAPI:!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,ajaxUpload:!!window.XMLHttpRequestUpload&&!!window.FormData,typeFiltering:typeof document.createElement("input").accept=="string",progressbar:document.createElement("progress").max!==void 0},p={sizeLimit:function(e,t){return e<=t},fileType:function(e,t){var n,r,i,s;if(t===[]||!l.typeFiltering)return!0;n=!1;if(!!t)for(i=0,s=t.length;i<s;i++)r=t[i],~r.indexOf(e)&&(n=!0);return n}},d=function(e){var t,n,r,i,s,o;n=e.input.files,i=e.settings,r=[];if(n.length===0)return i.onError.apply(e,["No file selected"]),!1;for(s=0,o=n.length;s<o;s++)t=n[s],i.sizeLimit!==0&&!p.sizeLimit(t.size,i.sizeLimit)&&r.push('"'+t.name+'" is '+t.size+" bytes. Your provided limit is "+i.sizeLimit),i.allowedTypes.length!==0&&!p.fileType(t.type,i.allowedTypes)&&r.push('"'+t.name.split(".")[1]+'" is not a valid file type/extension: '+i.allowedTypes);return r.length>0&&i.onError.apply(e,r),r.length===0},m}.call(this),window.AjaxFileUploadFlashProxy=function(e,t,n){var r;r=window.AjaxFileUpload.instances[e],r.settings[t].apply(r,n)},window.AjaxFileUpload=e,window.jQuery&&(jQuery.ajaxFileUpload=e,jQuery.fn.ajaxFileUpload=function(t){return this.each(function(n,r){new e(r,t)})}),typeof define=="function"&&define.amd&&define("ajaxFileUpload",[],function(){return e})}).call(this);