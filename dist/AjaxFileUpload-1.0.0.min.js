/*! Ajax File Upload Plugin - v1.0.0 - 2013-02-02
* https://github.com/jchild3rs/AjaxFileUpload
* Copyright (c) 2013 James Childers; Licensed MIT */
(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function l(e,r){var i=this;this.input=e,this.upload=t(this.upload,this);if(this.input===null||f.validate.inputType(this.input.type===!1))return;this.settings=f.merge(n,r),this.settings.url===""&&(this.settings.url=this.input.getAttribute("data-url")),this.settings.url===""&&this.input.form.action!==""&&(this.settings.url=this.input.form.action);if(this.settings.url==="")return;this.settings.additionalData!=={}&&(this.settings.url+="?"+f.serialize(this.settings.additionalData)),f.bindEvent(this.input,"change",function(e){return u(e,i)})}var e,n,r,i,s,o,u,a,f;return n={url:"",additionalData:{},autoUpload:!0,dataType:"json",method:"post",onSuccess:function(){},onError:function(){},onFileSelect:function(){},onProgress:function(){},onProgressStart:function(){},onProgressEnd:function(){}},l.prototype.upload=function(){return f.has.ajaxUpload?e(this):a(this)},u=function(e,t){var n;return t.settings.autoUpload&&t.upload(),(n=t.settings).onFileSelect.apply(n,[e.target])},e=function(e){var t,n,u,a;f.has.ajaxUpload&&(e.xhr=new XMLHttpRequest),e.xhr.upload?(e.xhr.upload.addEventListener("progress",function(t){return r(t,e)},!1),e.xhr.upload.addEventListener("loadstart",function(t){return s(t,e)},!1),e.xhr.upload.addEventListener("load",function(t){return i(t,e)},!1)):e.xhr.addEventListener("progress",function(t){return r(t,e)},!1),e.xhr.addEventListener("readystatechange",function(t){return o(t,e)},!1),f.has.formData&&(e.formData=new FormData),a=e.input.files;for(n=0,u=a.length;n<u;n++)t=a[n],e.formData.append(t.name,t);e.xhr.open(e.settings.method,e.settings.url,!0);switch(e.settings.dataType){case"json":e.xhr.setRequestHeader("Accept","application/json");break;case"xml":e.xhr.setRequestHeader("Accept","text/xml");break;default:}return e.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.xhr.send(e.formData)},o=function(e,t){var n,r,i;if(t.xhr.readyState!==4)return;n=t.xhr.responseText,~t.xhr.getResponseHeader("content-type").indexOf("application/json")&&(n=JSON.parse(n)),t.xhr.status===200||t.xhr.status===201?(r=t.settings).onSuccess.apply(r,[n,t.input.files,t.xhr]):(i=t.settings).onError.apply(i,[n,t.input.files,t.xhr])},i=function(e,t){var n;return(n=t.settings).onProgressEnd.apply(n,[e,t.input.files,t.xhr])},r=function(e,t){var n;return(n=t.settings).onProgress.apply(n,[e,t.input.files,t.xhr])},s=function(e,t){var n;return(n=t.settings).onProgressStart.apply(n,[e,t.input.files,t.xhr])},a=function(e){var t,n;return e.input.form.action=e.settings.url,e.input.form.target="fu-iframe",e.input.form.method=e.settings.method,e.input.form.enctype="multipart/form-data",e.input.form.encoding="multipart/form-data",t=document.getElementById("fu-iframe"),t==null&&(t=document.createElement("iframe")),t.id="fu-iframe",t.name="fu-iframe",t.style.display="none",f.bindEvent(t,"load",function(){var n,r,i,s,o;return t=window.frames["fu-iframe"],t.document.body.children.length>0||t.document.body.children.length===1?r=t.document.body.children[0].innerHTML:r=t.document.body.innerHTML,r!=null?(n=JSON.parse(r),(i=e.settings).onProgressEnd.apply(i,[n,e.input.files,e.xhr]),(s=e.settings).onSuccess.apply(s,[n,e.input.value,e.xhr])):(o=e.settings).onError.apply(o,[null,e.input.value,e.xhr])}),f.bindEvent(t,"error",function(){var t,n,r;window.frames["fu-iframe"].document.body.children.length>0?n=window.frames["fu-iframe"].document.body.children[0].innerHTML:n=window.frames["fu-iframe"].document.body.innerHTML,t=JSON.parse(n),(r=e.settings).onError.apply(r,[t,e.input.value,e.xhr])}),document.getElementById("fu-iframe")||document.body.appendChild(t),e.input.form.submit(),(n=e.settings).onProgressStart.apply(n,[event,e.input.files,e.xhr])},f={serialize:function(e,t){var n,r,i,s;i=[];for(r in e)s=e[r],n=t?t+"["+r+"]":r,typeof s=="object"?i.push(f.serialize(s,n)):i.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return i.join("&")},merge:function(e,t){var n;for(n in t)try{t[n].constructor===Object?e[n]=f.merge(e[n],t[n]):e[n]=t[n]}catch(r){e[n]=t[n]}return e},has:{formData:!!window.FormData,fileAPI:!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,ajaxUpload:!!window.XMLHttpRequestUpload},bindEvent:function(e,t,n,r){return!r||(r=!0),typeof e.addEventListener!="undefined"?e.addEventListener(t,n,r):e.attachEvent("on"+t,n)},triggerEvent:function(e,t){if((e[t]||!1)&&typeof e[t]=="function")return e[t](e)},validate:{inputType:function(e){return e==="file"},fileName:function(e){return e!==""}}},l}(),window.jQuery&&(jQuery.ajaxFileUpload=e,jQuery.fn.ajaxFileUpload=function(t){return this.each(function(n,r){new e(r,t)})}),typeof define=="function"&&define.amd&&define("ajaxFileUpload",[],function(){return e}),window.AjaxFileUpload=e}).call(this);