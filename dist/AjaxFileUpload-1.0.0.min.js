/*! Ajax File Upload Plugin - v1.0.0 - 2013-02-24
* https://github.com/jchild3rs/AjaxFileUpload
* Copyright (c) 2013 James Childers; Licensed MIT */
(function(){var e;e=function(){function v(e,n){var i=this;this.input=e;if(this.input===null||this.input.type!=="file")return;this.settings=c.merge(t,n);if(this.input.multiple||this.settings.multiple)this.input.multiple=!0,this.settings.multiple=!0;this.settings.url===""&&(this.settings.url=this.input.getAttribute("data-url")),this.settings.url===""&&this.input.form.action!==""&&(this.settings.url=this.input.form.action);if(this.settings.url==="")return;this.settings.additionalData!=={}&&(this.settings.url+=""+c.serialize(this.settings.additionalData)),f.fileAPI&&f.ajaxUpload?this.input.addEventListener("change",function(e){return a(e,i)}):r(this),this.settings.showCustomInput&&l(this),window.AjaxFileUpload=window.AjaxFileUpload||v,window.AjaxFileUpload.instances=v.instances||[],window.AjaxFileUpload.instances[this.input.id]=this}var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d=this;return t={url:"",additionalData:{},autoUpload:!1,dataType:"json",method:"post",pathToSwf:"AjaxFileUpload.swf",showCustomInput:!1,buttonEmptyText:"Select",buttonSelectedText:"Upload",showProgressBar:!1,debug:!1,multiple:!1,sizeLimit:0,allowedTypes:"",onSuccess:function(){},onError:function(){},onFileSelect:function(){},onProgress:function(){},onProgressStart:function(){},onProgressEnd:function(){}},a=function(t,r){var i,s,o;o=r.settings,o.showCustomInput&&(i=document.getElementById("fu-button-"+t.target.id),s=document.getElementById("fu-input-"+t.target.id)),p(r)&&(o.autoUpload&&e(r),o.onFileSelect.apply(o,[t.target.files]),o.showCustomInput&&(i.innerHTML=o.buttonSelectedText,c.css(r.input,{display:"none"}),i.onclick=function(){return e(r),!1},n(s,t.target.files)))},e=function(e){var t,n,r,a,f,l;r=new XMLHttpRequest,r.upload?(r.upload.addEventListener("progress",function(t){return i(t,e)}),r.upload.addEventListener("loadstart",function(t){return o(t,e)}),r.upload.addEventListener("load",function(t){return s(t,e)})):r.addEventListener("progress",function(t){return i(t,e)}),r.addEventListener("readystatechange",function(t){return u(t,e)}),n=new FormData,l=e.input.files;for(a=0,f=l.length;a<f;a++)t=l[a],n.append(t.name,t);r.open(e.settings.method,e.settings.url,!0);switch(e.settings.dataType){case"json":r.setRequestHeader("Accept","application/json");break;case"xml":r.setRequestHeader("Accept","text/xml");break;default:}r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(n)},u=function(e,t){var n,r,i,s;r=e.target;if(r.readyState!==4)return;n=r.responseText,~r.getResponseHeader("content-type").indexOf("application/json")&&!!window.JSON&&(n=JSON.parse(n)),r.status===200||r.status===201?(i=t.settings).onSuccess.apply(i,[n,t.input.files,r]):(s=t.settings).onError.apply(s,[n,t.input.files,r])},o=function(e,t){var n;return(n=t.settings).onProgressStart.apply(n,[t.input.files,e.target])},i=function(e,t){var n;return(n=t.settings).onProgress.apply(n,[e.loaded,e.total,t.input.files,e.target])},s=function(e,t){var n;return(n=t.settings).onProgressEnd.apply(n,[t.input.files,e.target])},r=function(e){var t,n,r,i,s,o,u,a;r={id:e.input.id,url:e.settings.url,method:e.settings.method,debug:e.settings.debug,multiple:e.settings.multiple,additionalData:e.settings.additionalData,sizeLimit:e.settings.sizeLimit,allowedTypes:e.settings.allowedTypes},u={movie:e.settings.pathToSwf,quality:"low",play:"true",loop:"true",wmode:"transparent",scale:"noscale",menu:"true",devicefont:"false",salign:"",allowScriptAccess:"sameDomain",flashvars:c.serialize(r)},t={src:e.settings.pathToSwf,id:"fu-embed-"+e.input.id,name:"fu-embed-"+e.input.id,classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",FlashVars:c.serialize(r),width:e.input.offsetWidth+5,height:e.input.offsetHeight+5,style:"position: absolute"},n=document.getElementById("fu-embed-"+e.input.id),n||(n=document.createElement("embed")),s=document.getElementById("fu-object-"+e.input.id),s||(s=document.createElement("object")),c.attr(s,{classid:"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",id:"fu-object-"+e.input.id,align:"left"});for(i in u)a=u[i],u.hasOwnProperty(i)&&(o=document.createElement("param"),c.attr(o,{name:i,value:a}),s.appendChild(o));c.attr(n,c.merge(t,u)),s.appendChild(n),e.input.parentNode.insertBefore(s,e.input.nextSibling)},l=function(e){var t,n,r,i,s;return r=e.input,s="fu-wrap-"+r.id,i=document.createElement("div"),c.attr(i,{"class":"fu-wrap",id:s}),c.css(i,{position:"relative"}),n=document.createElement("input"),c.attr(n,{type:"text",disabled:"disabled","class":"fu-input",id:"fu-input-"+r.id}),t=document.createElement("button"),c.attr(t,{"class":"fu-button",id:"fu-button-"+r.id}),e.settings.autoUpload?t.innerHTML=e.settings.buttonSelectedText:t.innerHTML=e.settings.buttonEmptyText,t.onclick=function(e){return!1},i.appendChild(n),i.appendChild(t),r.parentNode.insertBefore(i,r.nextSibling),i.appendChild(r),c.css(r,{position:"absolute",top:0,left:0,opacity:0}),r.onmouseover=function(){return c.attr(i,{"class":"fu-wrap fu-hover"})},r.onmouseout=function(){return c.attr(i,{"class":"fu-wrap"})},r.onmousedown=function(){return c.attr(i,{"class":"fu-wrap fu-active"})},r.onmouseup=function(){return c.attr(i,{"class":"fu-wrap"})},c.css(r,{width:document.getElementById(s).clientWidth+"px",height:document.getElementById(s).clientHeight+"px"}),r},n=function(e,t){var n,r,i,s;if(t.length===0)return;if(t.length===1)return e.value=t[0].name;if(t.length>1){r="";for(i=0,s=t.length;i<s;i++)n=t[i],r+=n.name+" ";return e.value=r}},c={css:function(e,t){var n,r,i;i=[];for(n in t)r=t[n],i.push(e.style[n]=r);return i},attr:function(e,t){var n,r,i;i=[];for(n in t)r=t[n],n==="class"?i.push(e.className=r):t.hasOwnProperty(n)?i.push(e.setAttribute(n,r)):i.push(void 0);return i},serialize:function(e,t){var n,r,i,s;i=[];for(r in e)s=e[r],n=t?t+"["+r+"]":r,typeof s=="object"?i.push(c.serialize(s,n)):i.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return i.join("&")},merge:function(e,t){var n;for(n in t)try{t[n].constructor===Object?e[n]=c.merge(e[n],t[n]):e[n]=t[n]}catch(r){e[n]=t[n]}return e}},f={fileAPI:!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,ajaxUpload:!!window.XMLHttpRequestUpload&&!!window.FormData},h={sizeLimit:function(e,t){return e<=t},fileType:function(e,t){var n,r,i,s,o;n=!1;if(!!t){e=e.split("/")[1],r=t.toString().replace(/\*/g,"").split(";");for(s=0,o=r.length;s<o;s++)i=r[s],~i.indexOf(e)&&(n=!0)}return n}},p=function(e){var t,n,r,i,s,o;n=e.input.files,i=e.settings,r=[];if(n.length===0)return i.onError.apply(this,["No file selected"]),!1;for(s=0,o=n.length;s<o;s++)t=n[s],h.sizeLimit(t.size,i.sizeLimit)||r.push('"'+t.name+'" is '+t.size+" bytes. Your provided limit is "+i.sizeLimit),h.fileType(t.type,i.allowedTypes)||r.push('"'+t.name.split(".")[1]+'" is not a valid file type/extension: '+i.allowedTypes);return r.length>0&&i.onError.apply(this,r),r.length===0},v}.call(this),window.AjaxFileUploadFlashProxy=function(e,t,n){var r;r=window.AjaxFileUpload.instances[e],r.settings[t].apply(r,n)},window.AjaxFileUpload=e,window.jQuery&&(jQuery.ajaxFileUpload=e,jQuery.fn.ajaxFileUpload=function(t){return this.each(function(n,r){new e(r,t)})}),typeof define=="function"&&define.amd&&define("ajaxFileUpload",[],function(){return e})}).call(this);